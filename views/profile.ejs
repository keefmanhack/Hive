<%- include('./partials/header')%>
<div class="page-container" id="profile-page">
	<div id="top-section">
		<div id="user-info">
			<div id="profile-image">
				<%if(currentUser && currentUser.profile_image && currentUser.profile_image.cropped_profile_path){%>
					<img src="<%=currentUser.profile_image.cropped_profile_path%>">
				<%}else{%>
					<img src="/photos/generic_person.jpg">
				<%}%>	
			</div>
			<i class="fas fa-camera"></i>
			<h1 ><strong><%=currentUser.firstName%> <%=currentUser.lastName%></strong></h1>
		</div>

		<hr>
		<div class="row" id='profile-nav'>
			<div class="col-auto">
				<button onclick="switchToTalents(this);" id="talents-button" class="active btn btn-primary">Talents</button>
			</div>
			<div class="col-auto">
				<button onclick="switchToAbout(this);" id="about-button" class='btn btn-primary'>About</button>
			</div>
			<div class="col-auto">
				<button class='btn btn-primary'>Your Hive</button>
			</div>
			<div class="col-auto">
				<button class='btn btn-primary'>Financials</button>
			</div>
			<div class="col-auto">
				<button class='btn btn-primary'>More info</button>
			</div>		
		</div>
	</div>
	<div class="content-section">
		<div class="page active" id="talents">
			<div class="selector-bar">
				<div class="row">
					<div class="col-lg-2">
						<select>
							<option>1</option>
						</select>
					</div>
					<div class="col-lg-2">
						<button class="btn btn-primary">Manage</button>
					</div>
					<div class="col-lg-6">
						<!-- I'm intentionally empty -->
					</div>
					<div class="col-lg-2">
						<button class="btn btn-primary">New Talent</button>
					</div>
				</div>
			</div>
			<div class="talent-item ">
				<div class="row">
					<div class="col-lg-8 product-summary">
						<div class="row">
							<div class="col">
								<a class="user" href=""><%=currentUser.firstName%> <%=currentUser.lastName%></a>
								<input type="text" name="product" class="title" value="Product" placeholder="Talent Name">
								<h5 class="rating orange-color"><i class="fas fa-star"></i> <i class="fas fa-star"></i> <i class="fas fa-star"></i> <i class="fas fa-star"></i> <i class="fas fa-star"></i></h5>
								<div class="price-formatter">
									<h1 class="price">$</h1>
									<input type="number" min="0" class="price ones" name="price" placeholder="100">
									<h1 class="price">.</h1>
									<input type="number" class="price decimal" name="price" min="0" placeholder="00">
								</div>
								<div class="pricing-method-formatter">
									<h2 class='pricing-method'>/</h2>
									<input type="text" class="pricing-method" name="pricing_method" placeholder="per event">
								</div>
								
								
								<hr>
								<ul>
									<li>
										<textarea name="basic-info" class="description-bullet" onkeypress="addBullet(event, this);" placeholder="Summary information"></textarea>
										<button onclick="removeLI(this)">X</button>
									</li>
								</ul>
							</div>
							<div class="col showcase">
								<img src="/photos/logo.jpeg">
								<div class="add-photo">
									<button class="btn btn-primary add-edit" onclick="showAddEditPhotoForm()">Add/ Edit Photos</button>
								</div>
							</div>
						</div>
					</div>
					<div class="col-lg-3 availability">
						<h1 class="price">$100.67</h1>
						<%- include('./partials/calendar')%>
					</div>
				</div>
				<div class="row description">
					<div class="col-lg-4 profile-container">
						<div class="name-and-photo orange-background">
							<div class="row">
								<div class="col">
									<img src="<%=currentUser.profile_image.cropped_profile_path%>">
						 			<a href=""><h1><%=currentUser.firstName%> <%=currentUser.lastName%></h1></a>
								</div>
							</div>
						</div>
						<div class="basic-user">
							<div class="row social-links">
								<div class="col-sm-3">
									<a href="">Reviews</a>
								</div>
								<div class="col-sm-1">
									<a href=""><h1><i class="fab fa-instagram"></i></h1></a>
								</div>
								<div class="col-sm-1">
									<a href=""><h1><i class="fab fa-facebook"></i></h1></a>
								</div>
								<div class="col-sm-1">
									<a href=""><h1><i class="fab fa-twitter"></i></h1></a>
								</div>
							</div>
						 <p><%=currentUser.about.bio.text%></p>
						 <div class="skills">
						 	<h2>Skill 1</h2>
						 	<h2>Skill 2</h2>
						 	<h2>Skill 3</h2>
						 </div>
						 <div class="experiences">
						 	<%currentUser.about.work.forEach(function(o){%>
							 	<div class="row item">
							 		<div class="col-lg-3">
							 			<img src="<%=o.companyLogo%>">
							 		</div>
							 		<div class="col-lg-9">
							 			<div class="row company-info">
							 				<div class="col">
							 					<h2 class="company"><%=o.company%></h2>
							 				</div>
							 				<div class="col">
							 					<h2 class="position"><%=o.position%></h2>
							 				</div>
							 			</div>
							 		</div>
							 	</div>
							 <%})%>
						 </div>
						</div>
					</div>
					<div class="col-lg-8">
						<h1>Learn More</h1>
						<div class="scroll-window">
							<img src="/photos/logo.jpeg">
							<img src="/photos/logo_invert.jpeg">
							<img src="/photos/logo.jpeg">
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col">
						<h1>Ratings</h1>
					</div>
				</div>
			</div>
		</div>
		<div class="page" id="about">
			<div class="row">
				<div class="col-lg-3 left">
					<h1>About</h1>
					<ul>
						<li onclick="menuChange(this);" class="active">Bio</li>
						<li onclick="menuChange(this);">Work</li>
						<li onclick="menuChange(this);">Eduation</li>
					</ul>
				</div>
				<div class="col right">
					<div id="bio" class="active">
						<form on action="/user/<%=currentUser._id%>/edit/bio" method="POST">
							<textarea name="text"><% if (currentUser && currentUser.about && currentUser.about.bio){%><%=currentUser.about.bio.text%><%}%></textarea>
							<div class="row">
								<div class="col-lg-3">
									<button type="button" onclick="bioEditable();" id="edit" class="strip btn btn-primary">Edit</button>
								</div>
								<div class="col-lg-5">
									<!-- Im empty on purpose -->
								</div>
								<div class="col-lg-2">
									<button type="button" onclick="bioNotEditable();" id="cancel" class="strip btn btn-primary">Cancel</button>
								</div>
								<div class="col-lg-2">
									<button id="save" class="strip btn btn-primary">Save</button>
								</div>
							</div>
						</form>
					</div>
					<%- include('./profile_partials/work.ejs')%>
					<div id="education">
						
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<%- include('./profile_pic/new_or_edit')%>
<%- include('./profile_pic/photo_editor')%>
<%- include('./talent_photos/add_edit')%>

<script type="text/javascript" src='/scripts/work.js'></script>
<script type="text/javascript" src='/scripts/editWork.js'></script>
<script type="text/javascript" src='/scripts/photo_edit.js'></script>
<script type="text/javascript" src='/scripts/autoFillAjax.js' userId='<%=currentUser._id%>'></script>
<script type="text/javascript" src='/scripts/profileImage.js'></script>
<script type="text/javascript" src='/scripts/calendar.js'></script>
<script type="text/javascript" src='/scripts/talent_photo_form.js'></script>

<script type="text/javascript">
	var arr;
	var editMode = false;
	var currentFocus =-1;
	var years = buildYears();
	var aboutRelation = {
		bio:{
			li: document.querySelectorAll('#about .left ul li')[0],
			section: document.querySelector('#about .right #bio')
		},
		work:{
			li: document.querySelectorAll('#about .left ul li')[1],
			section: document.querySelector('#about .right #work')
		},
		education:{
			li: document.querySelectorAll('#about .left ul li')[2],
			section: document.querySelector('#about .right #education')
		}
	}
	initializeAutoFillEvenListeners(document.getElementById('company'));
	initializeAutoFillEvenListeners(document.getElementById('position'));
	initializeAutoFillEvenListeners(document.getElementById('city'));


	addYearsToDropDown(document.getElementById('from'));
	addYearsToDropDown(document.getElementById('to'));

	//bio
	$('#about .right #bio textarea').prop('disabled', true); 


	//create event listeners for drag event
	dragElement(document.getElementById("photo"),document.getElementById("profile_img"));



	function addBullet(e, input){
		input.style.height = '1px';
		input.style.height = (3+input.scrollHeight)+"px"
		if(e.code == 'Enter'){
			e.preventDefault();
			console.log(input.parentNode.parentNode);
			input.parentNode.parentNode.insertAdjacentHTML('beforeend', `<li>
										<textarea name="basic-info" class="description-bullet" onkeypress="addBullet(event, this);" placeholder="Summary information"></textarea>
										<button onclick="removeLI(this)">X</button>
									</li>`);
			$('ul li textarea').slice($('ul li textarea').length-1, $('ul li textarea').length).focus();
		}
	}

	function removeLI(button){
		if (button.parentNode.parentNode.childNodes.length -2 >1){
			button.parentNode.remove();
		}
	}

	function switchToAbout(button){
		$('#profile-nav button').removeClass('active');
		button.classList.add('active');

		$('.content-section .page').removeClass('active');
		$('.content-section #about').slice(0,1).addClass('active');
	}

	function switchToTalents(button){
		$('#profile-nav button').removeClass('active');
		button.classList.add('active');

		$('.content-section .page').removeClass('active');
		$('.content-section #talents').slice(0,1).addClass('active');
	}

	function menuChange(li){
		$('#about .left li').removeClass('active');
		li.classList.add('active');
		
		for(var x in aboutRelation){
			if(aboutRelation[x].li === li){
				aboutRelation[x].section.classList.add('active');
			}else{
				aboutRelation[x].section.classList.remove('active');
			}
		}
	}

	function bioEditable(){
		$('#about .right #bio #edit').addClass('hide');
		$('#about .right #bio #cancel').addClass('show');
		$('#about .right #bio #save').addClass('show');

		$('#about .right #bio textarea').addClass('enabled');
		$('#about .right #bio textarea').prop('disabled', false); 

	}

	function bioNotEditable(){
		$('#about .right #bio #edit').removeClass('hide');
		$('#about .right #bio #cancel').removeClass('show');
		$('#about .right #bio #save').removeClass('show');

		$('#about .right #bio textarea').removeClass('enabled');
		location.reload();
	}

	function showMainPage(){
		$('.page-container').removeClass('hide');
		$('.photo-selector').removeClass('show');
		$('#photo-editor').removeClass('show');
	}

	function sendImage(data) {
  let urlEncodedData = "",
  urlEncodedDataPairs = [],
  name;

  for( name in data ) {
		urlEncodedDataPairs.push( encodeURIComponent( name ) + '=' + encodeURIComponent( data[name] ) );
	  }
	  urlEncodedData = urlEncodedDataPairs.join( '&' ).replace( /%20/g, '+' );

  var xmlHttpReq = false;

  if (window.XMLHttpRequest) {
    ajax = new XMLHttpRequest();
  }
  else if (window.ActiveXObject) {
    ajax = new ActiveXObject("Microsoft.XMLHTTP");
  }

  ajax.open("POST", "/user/<%=currentUser._id%>/edit_profile_image");
  ajax.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

  $('.loader').removeClass('hide');
  ajax.onreadystatechange = function() {
	    if (this.readyState == 4 && this.status == 200) {
	      showMainPage();
	      location.reload();
	    }
	  };

  ajax.send(urlEncodedData);
}

function sendTalentImage(data) {
  let urlEncodedData = "",
  urlEncodedDataPairs = [],
  name;

  for( name in data ) {
		urlEncodedDataPairs.push( encodeURIComponent( name ) + '=' + encodeURIComponent( data[name] ) );
	  }
	  urlEncodedData = urlEncodedDataPairs.join( '&' ).replace( /%20/g, '+' );

  var xmlHttpReq = false;

  if (window.XMLHttpRequest) {
    ajax = new XMLHttpRequest();
  }
  else if (window.ActiveXObject) {
    ajax = new ActiveXObject("Microsoft.XMLHTTP");
  }

  ajax.open("POST", "/user/<%=currentUser._id%>/talent/newimage");
  ajax.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

  $('.loader').removeClass('hide');
  ajax.onreadystatechange = function() {
	    if (this.readyState == 4 && this.status == 200) {
	      showMainPage();
	      location.reload();
	    }
	  };

  ajax.send(urlEncodedData);
}
</script>
<%- include('./partials/footer')%>