<%- include('./partials/header')%>
<div class="page-container" id="profile-page">
	<div id="top-section">
		<div id="user-info">
			<div id="profile-image">
				<%if(currentUser && currentUser.profile_image && currentUser.profile_image.cropped_profile_path){%>
					<img src="<%=currentUser.profile_image.cropped_profile_path%>">
				<%}else{%>
					<img src="/photos/generic_person.jpg">
				<%}%>	
			</div>
			<i class="fas fa-camera"></i>
			<h1 ><strong><%=currentUser.firstName%> <%=currentUser.lastName%></strong></h1>
		</div>

		<hr>
		<div class="row" id='profile-nav'>
			<div class="col-auto">
				<button id="talents-button" class="active btn btn-primary">Talents</button>
			</div>
			<div class="col-auto">
				<button id="about-button" class='btn btn-primary'>About</button>
			</div>
			<div class="col-auto">
				<button class='btn btn-primary'>Your Hive</button>
			</div>
			<div class="col-auto">
				<button class='btn btn-primary'>Financials</button>
			</div>
			<div class="col-auto">
				<button class='btn btn-primary'>More info</button>
			</div>		
		</div>
	</div>
	<div class="content-section">
		<div id="about">
			<div class="row">
				<div class="col-lg-3 left">
					<h1>About</h1>
					<ul>
						<li onclick="menuChange(this);" class="active">Bio</li>
						<li onclick="menuChange(this);">Work</li>
						<li onclick="menuChange(this);">Eduation</li>
					</ul>
				</div>
				<div class="col right">
					<div id="bio" class="active">
						<form on action="/user/<%=currentUser._id%>/edit/bio" method="POST">
							<textarea name="text"><% if (currentUser && currentUser.about && currentUser.about.bio){%><%=currentUser.about.bio.text%><%}%></textarea>
							<div class="row">
								<div class="col-lg-3">
									<button type="button" onclick="bioEditable();" id="edit" class="strip btn btn-primary">Edit</button>
								</div>
								<div class="col-lg-5">
									<!-- Im empty on purpose -->
								</div>
								<div class="col-lg-2">
									<button type="button" onclick="bioNotEditable();" id="cancel" class="strip btn btn-primary">Cancel</button>
								</div>
								<div class="col-lg-2">
									<button id="save" class="strip btn btn-primary">Save</button>
								</div>
							</div>
						</form>
					</div>
					<%- include('./profile_partials/work.ejs')%>
					<div id="education">
						
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<%- include('./profile_pic/new_or_edit')%>
<%- include('./profile_pic/photo_editor')%>

<script type="text/javascript" src='/scripts/work.js'></script>
<script type="text/javascript" src='/scripts/editWork.js'></script>
<script type="text/javascript" src='/scripts/photo_edit.js'></script>
<script type="text/javascript" src='/scripts/autoFillAjax.js' userId='<%=currentUser._id%>'></script>
<script type="text/javascript" src='/scripts/profileImage.js'></script>

<script type="text/javascript">
	var arr;
	var editMode = false;
	var currentFocus =-1;
	var years = buildYears();
	var aboutRelation = {
		bio:{
			li: document.querySelectorAll('#about .left ul li')[0],
			section: document.querySelector('#about .right #bio')
		},
		work:{
			li: document.querySelectorAll('#about .left ul li')[1],
			section: document.querySelector('#about .right #work')
		},
		education:{
			li: document.querySelectorAll('#about .left ul li')[2],
			section: document.querySelector('#about .right #education')
		}
	}
	initializeAutoFillEvenListeners(document.getElementById('company'));
	initializeAutoFillEvenListeners(document.getElementById('position'));
	initializeAutoFillEvenListeners(document.getElementById('city'));


	addYearsToDropDown(document.getElementById('from'));
	addYearsToDropDown(document.getElementById('to'));

	//bio
	$('#about .right #bio textarea').prop('disabled', true); 


	//create event listeners for drag event
	dragElement(document.getElementById("photo"),document.getElementById("profile_img"));

	function menuChange(li){
		$('#about .left li').removeClass('active');
		li.classList.add('active');
		
		for(var x in aboutRelation){
			if(aboutRelation[x].li === li){
				aboutRelation[x].section.classList.add('active');
			}else{
				aboutRelation[x].section.classList.remove('active');
			}
		}
	}

	function bioEditable(){
		$('#about .right #bio #edit').addClass('hide');
		$('#about .right #bio #cancel').addClass('show');
		$('#about .right #bio #save').addClass('show');

		$('#about .right #bio textarea').addClass('enabled');
		$('#about .right #bio textarea').prop('disabled', false); 

	}

	function bioNotEditable(){
		$('#about .right #bio #edit').removeClass('hide');
		$('#about .right #bio #cancel').removeClass('show');
		$('#about .right #bio #save').removeClass('show');

		$('#about .right #bio textarea').removeClass('enabled');
		location.reload();
	}

	function showMainPage(){
		$('.page-container').removeClass('hide');
		$('.photo-selector').removeClass('show');
		$('#photo-editor').removeClass('show');
	}

	function sendImage(data) {
  let urlEncodedData = "",
  urlEncodedDataPairs = [],
  name;

  for( name in data ) {
		urlEncodedDataPairs.push( encodeURIComponent( name ) + '=' + encodeURIComponent( data[name] ) );
	  }
	  urlEncodedData = urlEncodedDataPairs.join( '&' ).replace( /%20/g, '+' );

  var xmlHttpReq = false;

  if (window.XMLHttpRequest) {
    ajax = new XMLHttpRequest();
  }
  else if (window.ActiveXObject) {
    ajax = new ActiveXObject("Microsoft.XMLHTTP");
  }

  ajax.open("POST", "/user/<%=currentUser._id%>/edit_profile_image");
  ajax.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

  $('.loader').removeClass('hide');
  ajax.onreadystatechange = function() {
	    if (this.readyState == 4 && this.status == 200) {
	      showMainPage();
	      location.reload();
	    }
	  };

  ajax.send(urlEncodedData);
}

</script>
<%- include('./partials/footer')%>